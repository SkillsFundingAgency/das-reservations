@using System.Linq
@{
    object gaDataObject = ViewBag.GaData;
    if (gaDataObject == null)
    {
        gaDataObject = new GaData();
        ViewBag.GaData = gaDataObject;
    }

    string ReadProperty(string name, string defaultValue = "")
    {
        var property = gaDataObject.GetType().GetProperty(name);
        if (property == null)
        {
            return defaultValue;
        }

        var value = property.GetValue(gaDataObject);
        return value?.ToString() ?? defaultValue;
    }

    var extras = gaDataObject
        .GetType()
        .GetProperty("Extras")
        ?.GetValue(gaDataObject) as IDictionary<string, string> ?? new Dictionary<string, string>();

    var dataLoaded = ReadProperty("DataLoaded", "dataLoaded");
    var userId = ReadProperty("UserId");
    var vpv = ReadProperty("Vpv");
    var acc = ReadProperty("Acc");
    var ukPrn = ReadProperty("UkPrn");
    var org = ReadProperty("Org");
    var levyFlag = ReadProperty("LevyFlag");
}
<script>
    window.dataLayer = window.dataLayer || [];
    dataLayer.push({
        'event': '@dataLoaded',
        'userID': '@userId',
        'vpv': '@vpv',
        'acc': '@acc',
        'ukPrn': '@ukPrn',
        'org': '@org',
        'levyFlag': '@levyFlag'
        @if (extras.Any())
        {
            @Html.Raw(",");
        }
        @{
            var count = 0;
            foreach (var extra in extras)
            {
                count++;

                @Html.Raw($"'{extra.Key}' : '{extra.Value}'");
                if (count < extras.Count)
                {
                    @Html.Raw("," + Environment.NewLine);
                }
            }
        }
    });
</script>
